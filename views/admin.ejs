<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🔧 Admin Panel - Deutschlehrer Bot</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;margin:0;background:#f5f5f5}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.08);padding:20px;margin-bottom:20px}
    .btn{display:inline-block;background:#007bff;color:#fff;padding:8px 14px;border-radius:6px;text-decoration:none;margin-right:8px;margin-bottom:8px}
    .muted{color:#666}
    .pill{display:inline-block;padding:2px 10px;border-radius:14px;background:#e9ecef;margin-left:8px;font-weight:600}
    .admin-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:20px 0}
    .admin-section{background:#fff;border-radius:10px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.08)}
    .admin-section h3{color:#007bff;margin-top:0;border-bottom:2px solid #f0f0f0;padding-bottom:10px}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin:20px 0}
    .stat-card{text-align:center;padding:15px;background:#f8f9fa;border-radius:8px}
    .stat-number{font-size:2em;font-weight:bold;color:#007bff}
    .stat-label{color:#666;font-size:0.9em}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="card">
      <h1>🔧 Admin Panel - Vollständige Verwaltung</h1>
      <p class="muted">Verwalte alle Aspekte deines Deutschlehrer Bots</p>
      <div>
        <a class="btn" href="/">🏠 Startseite</a>
        <a class="btn" href="/admin/demo?password=test123">🚀 Demo erstellen</a>
        <a class="btn" href="/dashboard/courses" target="_blank">👨‍🎓 Schüler-Interface</a>
      </div>
    </div>
    
    <!-- Statistiken -->
    <div class="card">
      <h2>📊 Übersicht</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number"><%= stats.total_users %></div>
          <div class="stat-label">Gesamt Nutzer</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.approved_count %></div>
          <div class="stat-label">Aktive Nutzer</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.pending_count %></div>
          <div class="stat-label">Wartend</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.total_courses %></div>
          <div class="stat-label">Kurse</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.total_lessons %></div>
          <div class="stat-label">Lektionen</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.total_exercises %></div>
          <div class="stat-label">Übungen</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.active_subscriptions %></div>
          <div class="stat-label">Aktive Abos</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= Math.round(stats.avg_experience) %></div>
          <div class="stat-label">Ø XP</div>
        </div>
      </div>
    </div>
    
    <!-- Admin-Funktionen Grid -->
    <div class="admin-grid">
      <!-- Inhaltsverwaltung -->
      <div class="admin-section">
        <h3>📚 Inhaltsverwaltung</h3>
        <p>Erstelle und bearbeite Kurse, Lektionen und Übungen</p>
        <a class="btn" href="/admin/content?password=test123">Kurse verwalten</a>
        <a class="btn" href="/admin/courses">Kursübersicht</a>
      </div>
      
      <!-- Aufgabenbereich -->
      <div class="admin-section">
        <h3>📝 Aufgabenbereich</h3>
        <p>Erstelle interaktive Übungen für deine Schüler</p>
        <a class="btn" href="/admin/exercises?password=test123">Übungen verwalten</a>
        <a class="btn" href="/admin/exercises/create?password=test123">Neue Übung</a>
      </div>
      
      <!-- Schüler-Management -->
      <div class="admin-section">
        <h3>👨‍🎓 Schüler-Management</h3>
        <p>Verwalte alle Schüler und deren Fortschritt</p>
        <a class="btn" href="/admin/students?password=test123">Schüler anzeigen</a>
        <a class="btn" href="/admin">Nutzer genehmigen</a>
      </div>
      
      <!-- Billing-System -->
      <div class="admin-section">
        <h3>💳 Billing-System</h3>
        <p>Verwalte Abonnements und Rechnungen</p>
        <a class="btn" href="/admin/billing?password=test123">Abrechnungen</a>
        <a class="btn" href="/admin/billing/subscriptions?password=test123">Abonnements</a>
      </div>
    </div>

    <!-- Wartende Anmeldungen -->
    <h2>⏳ Wartende Anmeldungen</h2>
    <% if (pendingUsers.length === 0) { %>
      <div class="card">✅ Keine wartenden Anmeldungen</div>
    <% } else { %>
      <% pendingUsers.forEach(user => { %>
        <div class="card">
          <strong><%= user.name || 'Unbekannt' %></strong> 
          <span class="pill"><%= user.preferred_language || 'german' %></span>
          <div class="muted"><%= user.phone_number %></div>
          <button class="btn" onclick="approveUser('<%= user.phone_number %>')">✅ Genehmigen</button>
          <button class="btn" style="background:#dc3545" onclick="rejectUser('<%= user.phone_number %>')">❌ Ablehnen</button>
        </div>
      <% }); %>
    <% } %>

    <!-- Aktive Nutzer -->
    <h2>✅ Aktive Nutzer</h2>
    <% activeUsers.forEach(user => { %>
      <div class="card">
        <strong><%= user.name || 'Unbekannt' %></strong> 
        <span class="pill"><%= user.german_level || 'A1' %></span>
        <div class="muted"><%= user.phone_number %></div>
        <div><%= user.experience_points || 0 %> XP • Lektionen: <%= user.lessons_completed || 0 %></div>
        <% if (user.subscription_status) { %>
          <span class="pill" style="background:#28a745;color:white">
            <%= user.subscription_plan || 'basic' %> Abo
          </span>
        <% } %>
      </div>
    <% }); %>

    <script>
      function approveUser(phone){
        const password = prompt('Admin-Passwort (test123)'); 
        if(!password) return;
        fetch('/admin/approve',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({phone,password})
        })
        .then(r=>r.json())
        .then(d=>{ 
          if(d.success) location.reload(); 
          else alert(d.error || 'Fehler'); 
        });
      }
      
      function rejectUser(phone){
        const password = prompt('Admin-Passwort (test123)'); 
        if(!password) return;
        if(!confirm('Sicher ablehnen?')) return;
        fetch('/admin/reject',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({phone,password})
        })
        .then(r=>r.json())
        .then(d=>{ 
          if(d.success) location.reload(); 
          else alert(d.error || 'Fehler'); 
        });
      }
    </script>
  </div>
</body>
</html>

